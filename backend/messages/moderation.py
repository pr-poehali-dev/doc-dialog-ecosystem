import re

FORBIDDEN_PATTERNS = {
    'politics': [
        r'путин', r'зеленск', r'байден', r'трамп',
        r'выборы', r'политик', r'правительств', r'президент',
        r'госдум', r'кремл', r'оппозиц'
    ],
    'war': [
        r'сво', r'война', r'украин', r'донбасс', r'крым',
        r'военн', r'армия', r'солдат', r'фронт', r'мобилизац',
        r'всу', r'рф', r'нато'
    ],
    'weapons': [
        r'оружи', r'автомат', r'пистолет', r'граната',
        r'взрывчат', r'бомба', r'патрон', r'ствол',
        r'калаш', r'винтовк', r'снаряд'
    ],
    'drugs': [
        r'наркотик', r'героин', r'кокаин', r'марихуан',
        r'гашиш', r'спайс', r'амфетамин', r'мдма', r'лсд',
        r'экстази', r'закладк', r'барыг', r'дилер',
        r'план', r'трава', r'соль', r'меф'
    ],
    'prostitution': [
        r'проститу', r'эскорт', r'интим за деньги',
        r'интим услуг', r'секс услуг', r'путан'
    ],
    'profanity': [
        r'хуй', r'пизд', r'ебл', r'бля', r'сука',
        r'пидор', r'уёб', r'гандон', r'мудак', r'мудил',
        r'пидар', r'жопа', r'ебать', r'ебан', r'хер',
        r'манда', r'залупа', r'хуяр', r'охуе', r'пидр'
    ]
}


def check_content_moderation(text: str) -> tuple[bool, str, list]:
    """
    Проверка текста на запрещённый контент.
    
    Возвращает:
        (is_blocked, category, matched_words)
    """
    text_lower = text.lower()
    
    for category, patterns in FORBIDDEN_PATTERNS.items():
        matched_words = []
        for pattern in patterns:
            if re.search(pattern, text_lower):
                matched_words.append(pattern)
        
        if matched_words:
            return True, category, matched_words
    
    return False, '', []


def get_warning_message(category: str) -> str:
    """Получить текст предупреждения в зависимости от категории нарушения"""
    
    warnings = {
        'politics': '⚠️ Запрещено обсуждать политику',
        'war': '⚠️ Запрещено обсуждать военные конфликты',
        'weapons': '⚠️ Запрещено обсуждать оружие',
        'drugs': '⚠️ Запрещено обсуждать наркотики',
        'prostitution': '⚠️ Запрещены предложения интимных услуг',
        'profanity': '⚠️ Запрещена нецензурная лексика'
    }
    
    base_warning = warnings.get(category, '⚠️ Запрещённый контент')
    
    full_warning = f"""{base_warning}

При повторной попытке отправки запрещённого контента:
• Ваш аккаунт будет заблокирован навсегда
• Средства на балансе будут заморожены
• Разморозка средств возможна только после модерации

Пожалуйста, соблюдайте правила использования сервиса."""
    
    return full_warning
