# Pay-per-use –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º **—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã** (`schools.balance`) –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –∑–∞ –≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è. –ù–∏–∫–∞–∫–∏—Ö –Ω–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –º–æ–Ω–µ—Ç ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ —Ä—É–±–ª–∏.

## –ü—Ä–∞–π—Å-–ª–∏—Å—Ç

| –î–µ–π—Å—Ç–≤–∏–µ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|----------|-----------|--------|
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–∞ | ‚ÇΩ500 | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–º–∞–π–Ω–¥–∞ | ‚ÇΩ500 | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (1 –¥–µ–Ω—å) | ‚ÇΩ300 | ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (3 –¥–Ω—è) | ‚ÇΩ800 | ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞ (7 –¥–Ω–µ–π) | ‚ÇΩ1500 | ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –°–æ–æ–±—â–µ–Ω–∏–µ —à–∫–æ–ª–µ –æ—Ç –º–∞—Å—Å–∞–∂–∏—Å—Ç–∞ | ‚ÇΩ10 | üîÑ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è | ‚ÇΩ1000 | üîÑ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–∞ ‚Äî `/backend/courses`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –®–∫–æ–ª–∞ —Å–æ–∑–¥–∞—ë—Ç –∫—É—Ä—Å —á–µ—Ä–µ–∑ UI
2. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã
3. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Üí —Å–ø–∏—Å—ã–≤–∞–µ—Ç ‚ÇΩ500
4. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ `balance_transactions`
5. –ö—É—Ä—Å –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`

**–ö–æ–¥:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
cur.execute(f"SELECT balance FROM {schema}.schools WHERE id = {school_id}")
current_balance = cur.fetchone()[0]

if current_balance < 500:
    # –£–¥–∞–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫—É—Ä—Å
    cur.execute(f"DELETE FROM {schema}.courses WHERE id = {course_id}")
    return {'error': '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫—É—Ä—Å–∞'}

# –°–ø–∏—Å—ã–≤–∞–µ–º
cur.execute(f"""
    UPDATE {schema}.schools 
    SET balance = balance - 500
    WHERE id = {school_id}
""")

# –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
cur.execute(f"""
    INSERT INTO {schema}.balance_transactions 
    (school_id, masseur_id, amount, type, description, related_entity_type, related_entity_id, created_at)
    VALUES ({school_id}, -1, 500, 'withdrawal', '–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–∞: {title}', 'course', {course_id}, NOW())
""")
```

### 2. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–º–∞–π–Ω–¥–∞ ‚Äî `/backend/courses`

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∫—É—Ä—Å–∞–º ‚Äî —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è ‚ÇΩ500 —Å –±–∞–ª–∞–Ω—Å–∞ —à–∫–æ–ª—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞—Å—Ç–µ—Ä–º–∞–π–Ω–¥–∞.

### 3. –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ ‚Äî `/backend/promo-requests`

**–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!** –°–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º:
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —à–∫–æ–ª—ã
- –°–ø–∏—Å–∞–Ω–∏–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (1/3/7 –¥–Ω–µ–π)
- –ó–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## UI ‚Äî –ë–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/school/balance`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–π

**–ì–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:**
- Dashboard —à–∫–æ–ª—ã ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±–µ–∑ —Å—Ä–µ–¥—Å—Ç–≤ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

## –ö–∞–∫ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ü–æ–ø–æ–ª–Ω–∏—Ç—å"

**–¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –Æ–ö–∞—Å—Å–∞ / CloudPayments –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è
- Email —Å —á–µ–∫–æ–º –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

‚úÖ **–ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** ‚Äî –æ–¥–∏–Ω –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ  
‚úÖ **–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –æ–±—ä—è—Å–Ω—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–æ "–º–æ–Ω–µ—Ç—ã"  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è  

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –í `/backend/messages` –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã
- [ ] –°–ø–∏—Å—ã–≤–∞—Ç—å ‚ÇΩ10 –∑–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –º–∞—Å—Å–∞–∂–∏—Å—Ç–∞ –∫ —à–∫–æ–ª–µ
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Å—Ä–µ–¥—Å—Ç–≤

### 2. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è
- [ ] –í `/backend/submit-verification` —Å–ø–∏—Å—ã–≤–∞—Ç—å ‚ÇΩ1000
- [ ] –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏

### 3. UI —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- [ ] –ê–ª–µ—Ä—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ —Å—Ä–µ–¥—Å—Ç–≤
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å

### 4. –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Æ–ö–∞—Å—Å–∞
- [ ] Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–∫—É—Ä—Å/–º–∞—Å—Ç–µ—Ä–º–∞–π–Ω–¥)
3. –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
4. –ó–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

–ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å **—É–¥–∞–ª—è–µ—Ç—Å—è**.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `balance_transactions`:
- –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (deposit/withdrawal)
- –°—É–º–º–∞
- –û–ø–∏—Å–∞–Ω–∏–µ
- –°–≤—è–∑–∞–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å (course/mastermind/promotion)
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –í–æ–π—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç —à–∫–æ–ª—ã
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/school/balance`
3. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ ‚ÇΩ1000
4. –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–ø–∏—Å–∞–ª–æ—Å—å ‚ÇΩ500
6. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
- Email: school@test.ru
- –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ‚ÇΩ14,500 (—É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å)

## API

### –ë–∞–ª–∞–Ω—Å —à–∫–æ–ª—ã
```bash
GET /backend/balance?token=JWT_TOKEN
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```bash
GET /backend/balance?token=JWT_TOKEN&action=transactions
```

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (—Ç–µ—Å—Ç–æ–≤–æ–µ)
```bash
POST /backend/balance?token=JWT_TOKEN
{
  "action": "test_deposit",
  "amount": 1000
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å —à–∫–æ–ª
- –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π
- –°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–ê–ª–µ—Ä—Ç—ã:**
- –®–∫–æ–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ –±–µ–∑ —Å—Ä–µ–¥—Å—Ç–≤
- –ú–∞—Å—Å–æ–≤—ã–µ –æ—Ç–∫–∞–∑—ã –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- –ê–Ω–æ–º–∞–ª—å–Ω–æ –Ω–∏–∑–∫–∏–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å

## –≠–∫–æ–Ω–æ–º–∏–∫–∞

**–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã:**
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–∞: ‚ÇΩ500
- –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ: ‚ÇΩ300-1500
- –ò—Ç–æ–≥–æ –∑–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: ‚ÇΩ1500-2500

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å: ‚ÇΩ1000 (2 –∫—É—Ä—Å–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: ‚ÇΩ500
- –°–∫–∏–¥–∫–∏ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ >‚ÇΩ5000
