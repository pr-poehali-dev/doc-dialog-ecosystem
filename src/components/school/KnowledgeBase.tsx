import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import Icon from '@/components/ui/icon';
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";

interface FAQItem {
  question: string;
  answer: string;
  category: string;
}

const faqData: FAQItem[] = [
  // Общие вопросы
  {
    category: 'Общие вопросы',
    question: 'Как начать работу в кабинете школы?',
    answer: 'После регистрации создайте профиль школы в разделе "Моя школа". Заполните информацию о школе, добавьте логотип и описание. Затем можете приступать к публикации курсов, мастермайндов и очных обучений.'
  },
  {
    category: 'Общие вопросы',
    question: 'Что такое модерация и сколько она длится?',
    answer: 'Модерация — это проверка вашего контента администрацией платформы перед публикацией. Обычно занимает до 24 часов. Мы проверяем соответствие описания реальности и отсутствие запрещённого контента.'
  },
  {
    category: 'Общие вопросы',
    question: 'Как посмотреть статус моих публикаций?',
    answer: 'В каждой вкладке (Курсы, Мастермайнды, Очные обучения) вы видите статусы: "На модерации" (жёлтый), "Одобрено" (зелёный), "Отклонено" (красный). При отклонении указывается причина в комментарии модератора.'
  },

  // Курсы
  {
    category: 'Курсы',
    question: 'Как добавить курс?',
    answer: 'Нажмите "Добавить курс" во вкладке Курсы. Заполните обязательные поля: название школы, название курса, категорию, тип (онлайн/офлайн/бесплатный) и ссылку на страницу оплаты. Добавьте изображение, цену, описание программы и информацию об авторе. После сохранения курс отправится на модерацию.'
  },
  {
    category: 'Курсы',
    question: 'Что такое "URL обложки для лендинга" и "Ссылка для кнопки CTA"?',
    answer: 'URL обложки — это большая картинка, которая отображается в верхней части (hero блоке) лендинга вашего курса. Ссылка для кнопки CTA — это адрес, куда переходит пользователь при нажатии "Записаться на курс" в лендинге и футере.'
  },
  {
    category: 'Курсы',
    question: 'Можно ли редактировать опубликованный курс?',
    answer: 'Да, нажмите кнопку "Редактировать" у нужного курса. После сохранения изменений курс снова отправится на модерацию. До одобрения будет отображаться старая версия.'
  },
  {
    category: 'Курсы',
    question: 'Что означают "Полная цена" и "Цена со скидкой"?',
    answer: 'Полная цена (перечеркнутая) — это оригинальная стоимость курса. Цена со скидкой (красная) — это акционная цена. Если указать обе, пользователи увидят выгоду скидки в карточке курса.'
  },
  {
    category: 'Курсы',
    question: 'Как работают просмотры курсов?',
    answer: 'Счётчик просмотров увеличивается каждый раз, когда кто-то открывает лендинг вашего курса. Вы можете отслеживать популярность курсов по этой метрике в таблице.'
  },

  // Мастермайнды
  {
    category: 'Мастермайнды',
    question: 'Чем мастермайнд отличается от курса?',
    answer: 'Мастермайнд — это разовое мероприятие с конкретной датой проведения. Он имеет ограничение по количеству участников и подходит для живых встреч, воркшопов, нетворкингов и групповых сессий.'
  },
  {
    category: 'Мастермайнды',
    question: 'Как добавить мастермайнд?',
    answer: 'Перейдите во вкладку "Мастермайнды" и нажмите "Добавить мастермайнд". Укажите название, дату события, место проведения, максимальное количество участников, цену и ссылку на регистрацию. Добавьте описание, информацию об авторе и программу.'
  },
  {
    category: 'Мастермайнды',
    question: 'Что делать, когда набралось нужное количество участников?',
    answer: 'Вы можете отредактировать мастермайнд и указать текущее количество участников равное максимальному. Это покажет пользователям, что регистрация закрыта.'
  },
  {
    category: 'Мастермайнды',
    question: 'Можно ли выбрать категорию для мастермайнда?',
    answer: 'Да, при создании мастермайнда выберите категорию: Массажные техники, Бизнес и маркетинг, Общение и психология, Здоровье и безопасность, или Цифровые навыки. Это поможет пользователям найти ваше мероприятие.'
  },

  // Очные обучения
  {
    category: 'Очные обучения',
    question: 'Что такое очное обучение?',
    answer: 'Очное обучение — это офлайн курс или тренинг с конкретной датой проведения. Подходит для практических занятий, интенсивов и сертификационных программ с личным присутствием.'
  },
  {
    category: 'Очные обучения',
    question: 'Как добавить очное обучение?',
    answer: 'Откройте вкладку "Очные обучения" и нажмите "Добавить обучение". Заполните поля аналогично мастермайнду: название, дата, место, количество участников, цена, ссылка на регистрацию. Добавьте программу обучения и информацию о преподавателе.'
  },
  {
    category: 'Очные обучения',
    question: 'В чем разница между очным обучением и мастермайндом?',
    answer: 'Очное обучение — это полноценный курс с программой обучения, часто многодневный. Мастермайнд — это разовая встреча или воркшоп. Очное обучение больше фокусируется на передаче знаний и навыков, мастермайнд — на обмене опытом и нетворкинге.'
  },

  // Лендинги
  {
    category: 'Лендинги',
    question: 'Как создать полноценный лендинг для курса?',
    answer: 'Перейдите во вкладку "Лендинги" и нажмите "Создать новый лендинг". Вы сможете создать профессиональную посадочную страницу с hero-блоком, описанием курса, программой обучения, отзывами, FAQ и формой записи.'
  },
  {
    category: 'Лендинги',
    question: 'Могу ли я редактировать дизайн лендинга?',
    answer: 'Да, после создания лендинга вы можете открыть его в редакторе и настроить все элементы: тексты, изображения, цвета, блоки. Изменения сохраняются автоматически.'
  },
  {
    category: 'Лендинги',
    question: 'Как опубликовать лендинг?',
    answer: 'После создания и редактирования лендинга он автоматически получает уникальную ссылку. Просто отправьте эту ссылку на модерацию вместе с курсом, и после одобрения он станет доступен по прямому URL.'
  },

  // Промо и продвижение
  {
    category: 'Промо и продвижение',
    question: 'Что такое продвижение курса?',
    answer: 'Продвижение (промо) — это платная услуга, которая поднимает ваш курс в топ каталога. Есть два типа: продвижение в своей категории и продвижение во всех категориях.'
  },
  {
    category: 'Промо и продвижение',
    question: 'Сколько стоит продвижение?',
    answer: 'Продвижение в своей категории: 500₽ на 1 день, 1200₽ на 3 дня, 2500₽ на 7 дней. Продвижение во всех категориях: 1500₽ на 1 день, 3600₽ на 3 дня, 7500₽ на 7 дней.'
  },
  {
    category: 'Промо и продвижение',
    question: 'Как продвинуть курс?',
    answer: 'Нажмите кнопку "Продвинуть" у нужного курса (доступна только для одобренных курсов). Выберите тип продвижения и срок. Стоимость спишется с баланса школы, и курс сразу поднимется в топ каталога.'
  },
  {
    category: 'Промо и продвижение',
    question: 'Можно ли продвигать мастермайнды и очные обучения?',
    answer: 'Да, продвижение доступно для всех типов контента: курсов, мастермайндов и очных обучений. Механика та же — выбираете тип продвижения и срок.'
  },
  {
    category: 'Промо и продвижение',
    question: 'Как пополнить баланс школы?',
    answer: 'В верхней части кабинета отображается текущий баланс. Нажмите "Пополнить баланс", выберите сумму и оплатите. После зачисления средств вы сможете продвигать свои курсы.'
  },

  // Специалисты
  {
    category: 'Поиск специалистов',
    question: 'Что такое раздел "Поиск специалистов"?',
    answer: 'Это доска объявлений, где вы можете разместить запрос на поиск специалиста для вашей школы: видеооператора, дизайнера, SMM-менеджера, фотографа и других.'
  },
  {
    category: 'Поиск специалистов',
    question: 'Как разместить запрос на специалиста?',
    answer: 'Перейдите во вкладку "Поиск специалистов" и нажмите "Добавить запрос". Укажите название вакансии, описание задач, специальность, бюджет, локацию и дедлайн. Ваш запрос увидят специалисты на платформе.'
  },
  {
    category: 'Поиск специалистов',
    question: 'Сколько стоит размещение запроса?',
    answer: 'Размещение запросов на специалистов бесплатное. Вы платите только выбранному специалисту за выполненную работу напрямую.'
  },

  // Технические вопросы
  {
    category: 'Технические вопросы',
    question: 'Почему мой курс не отображается в каталоге?',
    answer: 'Курс появится в каталоге только после одобрения модератором. Проверьте статус курса в кабинете. Если статус "Отклонено", прочитайте комментарий модератора, исправьте ошибки и отправьте заново.'
  },
  {
    category: 'Технические вопросы',
    question: 'Как удалить курс/мастермайнд?',
    answer: 'Нажмите кнопку с иконкой корзины у нужного элемента. Подтвердите удаление. Внимание: удаление необратимо, восстановить данные будет невозможно.'
  },
  {
    category: 'Технические вопросы',
    question: 'Куда ведет ссылка "Внешний URL"?',
    answer: 'Это ссылка на страницу оплаты или регистрации на вашем сайте/сервисе. Когда пользователь нажимает "Записаться" или "Купить курс", он переходит по этой ссылке.'
  },
  {
    category: 'Технические вопросы',
    question: 'Можно ли добавить несколько авторов курса?',
    answer: 'В форме курса есть поле "Имя автора курса", где вы можете указать одного основного автора. Для указания дополнительных авторов используйте поле "Содержание курса" или создайте полноценный лендинг.'
  },
  {
    category: 'Технические вопросы',
    question: 'Какой формат изображений лучше использовать?',
    answer: 'Рекомендуем использовать JPG или PNG размером не менее 1200x800 пикселей. Для обложек лендингов — горизонтальные изображения 1920x1080. Укажите прямую ссылку на изображение (должна заканчиваться на .jpg или .png).'
  },

  // Статистика и аналитика
  {
    category: 'Статистика',
    question: 'Где посмотреть статистику по курсам?',
    answer: 'В таблице курсов отображается количество просмотров для каждого курса. Это показывает, сколько раз пользователи открывали лендинг курса.'
  },
  {
    category: 'Статистика',
    question: 'Как понять, работает ли продвижение?',
    answer: 'Во время активного продвижения ваш курс отображается в топе каталога с меткой "Промо". Следите за увеличением просмотров — промо-позиции обычно получают в 3-5 раз больше просмотров.'
  },
  {
    category: 'Статистика',
    question: 'Почему просмотры не увеличиваются?',
    answer: 'Просмотры считаются только когда кто-то открывает полную страницу (лендинг) вашего курса. Просмотры карточек в каталоге не учитываются. Убедитесь, что курс одобрен и отображается в каталоге.'
  }
];

export default function KnowledgeBase() {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');

  const categories = ['Все', ...Array.from(new Set(faqData.map(item => item.category)))];

  const filteredFAQ = faqData.filter(item => {
    const matchesSearch = item.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         item.answer.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesCategory = selectedCategory === 'Все' || item.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  return (
    <div className="container mx-auto px-4 py-8 max-w-5xl">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2 text-2xl">
            <Icon name="BookOpen" size={28} />
            База знаний
          </CardTitle>
          <CardDescription>
            Ответы на часто задаваемые вопросы о работе в кабинете школы
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Поиск */}
          <div className="relative">
            <Icon name="Search" size={20} className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground" />
            <Input
              placeholder="Поиск по вопросам..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10"
            />
          </div>

          {/* Категории */}
          <div className="flex flex-wrap gap-2">
            {categories.map(category => (
              <button
                key={category}
                onClick={() => setSelectedCategory(category)}
                className={`px-4 py-2 rounded-full text-sm transition-colors ${
                  selectedCategory === category
                    ? 'bg-primary text-primary-foreground'
                    : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'
                }`}
              >
                {category}
              </button>
            ))}
          </div>

          {/* FAQ список */}
          {filteredFAQ.length === 0 ? (
            <div className="text-center py-12 text-muted-foreground">
              <Icon name="Search" size={48} className="mx-auto mb-4 opacity-50" />
              <p>По вашему запросу ничего не найдено</p>
              <p className="text-sm mt-2">Попробуйте изменить поисковый запрос или выбрать другую категорию</p>
            </div>
          ) : (
            <Accordion type="single" collapsible className="w-full">
              {filteredFAQ.map((item, index) => (
                <AccordionItem key={index} value={`item-${index}`}>
                  <AccordionTrigger className="text-left hover:no-underline">
                    <div className="flex items-start gap-3 pr-4">
                      <Icon name="HelpCircle" size={20} className="text-primary mt-0.5 flex-shrink-0" />
                      <div>
                        <div className="font-medium">{item.question}</div>
                        <div className="text-xs text-muted-foreground mt-1">{item.category}</div>
                      </div>
                    </div>
                  </AccordionTrigger>
                  <AccordionContent className="text-muted-foreground pl-8 pr-4">
                    {item.answer}
                  </AccordionContent>
                </AccordionItem>
              ))}
            </Accordion>
          )}

          {/* Дополнительная помощь */}
          <Card className="bg-muted/50">
            <CardContent className="pt-6">
              <div className="flex items-start gap-3">
                <Icon name="MessageCircle" size={24} className="text-primary mt-1" />
                <div>
                  <h3 className="font-semibold mb-1">Не нашли ответ?</h3>
                  <p className="text-sm text-muted-foreground mb-3">
                    Если у вас остались вопросы, свяжитесь с нашей службой поддержки в Telegram-сообществе
                  </p>
                  <a 
                    href="https://t.me/+QgiLIa1gFRY4Y2Iy" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors text-sm"
                  >
                    <Icon name="Send" size={16} />
                    Написать в поддержку
                  </a>
                </div>
              </div>
            </CardContent>
          </Card>
        </CardContent>
      </Card>
    </div>
  );
}
